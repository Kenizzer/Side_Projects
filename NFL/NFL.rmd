---
title: "NFL Game stats"
author: "Joel F. Swift"
date: "9/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('ggplot2')
library('ggpubr')
library('lubridate')
library('plotly')
theme_set(theme_pubr())
```

## Data importation and cleaning

This data set was generated by Reddit user **yuxbni76** <https://www.reddit.com/user/yuxbni76>
The data was scraped from ESPN.com and covers the **2002 to 2019 seasons** up to week 6. Three
games were missing in the data set (kind of weird they are all near holidays).

* DAL @ WASH 12-30-2007
* CAR @ PIT  12-23-2010
* TB  @ ATL  01-01-2012

So I found that data on <https://www.pro-football-reference.com/> and added it 
into the data set before importing.

```{r}
nfl_stats<- read.csv("nfl_dataset_2002-2019week6.csv")
summary(nfl_stats)
```


```{r}
# Convert columns that make sense to factor
## Home and away team names
nfl_stats$home <- as.factor(nfl_stats$home)
nfl_stats$away <- as.factor(nfl_stats$away)
```

## Team colors
Team colors were extracted from <https://teamcolorcodes.com>, I took the first primary color
for each team and created a list that will be for later use. For the Browns and Titans I took the
secondary color as it seemed more *appropriate*.


```{r}
Team_colors <- c("49ers"="#AA0000",
                 "Bears"="#0B162A",
                 "Bengals"="#FB4F14",
                 "Bills"="#00338D",
                 "Broncos"="#FB4F14",
                 "Browns"="#FF3C00",
                 "Buccaneers"="#D50A0A",
                 "Cardinals"="#97233F",
                 "Chargers"="#0080C6",
                 "Chiefs"="#E31837",
                 "Colts"="#002C5F",
                 "Cowboys"="#041E42",
                 "Dolphins"="#008E97",
                 "Eagles"="#004C54",
                 "Falcons"="#A71930",
                 "Giants"="#0B2265",
                 "Jaguars"="#006778",
                 "Jets"="#125740",
                 "Lions"="#0076B6",
                 "Packers"="#203731",
                 "Panthers"="#0085CA",
                 "Patriots"="#002244",
                 "Raiders"="#000000",
                 "Rams"="#003594",
                 "Ravens"="#241773",
                 "Redskins"="#773141",
                 "Saints"="#D3BC8D",
                 "Seahawks"="#002244",
                 "Steelers"="#FFB612",
                 "Texans"="#03202F",
                 "Titans"="#4B92DB",
                 "Vikings"="#4F2683")
```

## Simple plots

```{r ggplot2, fig1, fig.height = 3, fig.width = 12}
A <- ggplot(nfl_stats, aes(x = home)) + geom_bar(aes(fill = home)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Home Games") + ylab("# Games") + scale_fill_manual(values = Team_colors) +
  theme(legend.position = "none")
B <- ggplot(nfl_stats, aes(x = away)) + geom_bar(aes(fill = away)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  ggtitle("Away Games") + ylab("# Games") + scale_fill_manual(values = Team_colors) +
  theme(legend.position = "none")

ggarrange(A,B)
```

```{r}
# wins by team
Teams_32.list <- levels(nfl_stats$home)

numb_wins_list <- c()
for (i in Teams_32.list){
  x <- dim(nfl_stats[nfl_stats$home == i ,])
  y <- dim(nfl_stats[nfl_stats$home == i & nfl_stats$score_away < nfl_stats$score_home,] )
  z<- c(x[1], y[1])
  numb_wins_list[[i]] <- z
}
Home_wins_n_losses <-  as.data.frame(do.call(rbind, numb_wins_list))
colnames(Home_wins_n_losses) <- c("Games", "Wins")
Home_wins_n_losses$Losses <- Home_wins_n_losses$Games - Home_wins_n_losses$Wins
Home_wins_n_losses$Teams <- rownames(Home_wins_n_losses)



long <- reshape2::melt(Home_wins_n_losses[,-1], id='Teams')


ggplot(long, aes(x=Teams, y=value, fill=variable)) + geom_bar(stat = "identity")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

```

## Passing Yards
```{r}
nfl_stats$game_number <- seq(1,length(nfl_stats$date), 1)

# All teams
X <- ggplot(nfl_stats, aes(x=game_number, y=passing_yards_home, color = home, label=score_home, label2=score_away)) + geom_smooth(se=FALSE) + scale_color_manual(values = Team_colors) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=1, xmax=267, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=267, xmax=534, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=534, xmax=801, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=801, xmax=1068, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=1068, xmax=1335, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=1335, xmax=1602, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=1602, xmax=1869, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=1869, xmax=2136, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=2136, xmax=2403, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=2403, xmax=2670, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=2670, xmax=2937, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=2937, xmax=3204, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=3204, xmax=3471, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=3471, xmax=3738, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=3738, xmax=4005, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=4005, xmax=4272, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "black", alpha= 0.25, xmin=4272, xmax=4539, ymin=-Inf, ymax=Inf) +
  annotate("rect", fill = "white", alpha= 0.0, xmin=4539, xmax=4631, ymin=-Inf, ymax=Inf) +
  annotate("text", x = 134, y = 310, label = "2002", vjust = -0.5) +
  annotate("text", x = 4405, y = 310, label = "2018", vjust = -0.5) 
X
ggsave("Passing_yards_home2002-2018.png", X, width = 6,height = 6)

P <- ggplot(nfl_stats, aes(x=game_number, y=passing_yards_home, color = home, label=date, label2=score_home, label3=score_away)) + geom_smooth(se=FALSE) + scale_color_manual(values = Team_colors) +
  geom_point()

Q <- ggplot(nfl_stats, aes(x=game_number, y=passing_yards_away, color = away, label=date, label2=score_home, label3=score_away)) + geom_smooth(se=FALSE) + scale_color_manual(values = Team_colors) +
  geom_point()

ggplotly(P, tooltip = c('passing_yards_home', 'home', 'date','score_home','score_away'))
ggplotly(Q, tooltip = c('passing_yards_away', 'away', 'date','score_home','score_away'))


```


#```{r}
#AFC WEST
#ggplot(nfl_stats[nfl_stats$home == c('Chiefs', 'Raiders', 'Chargers', 'Broncos'),], aes(x=game_number, y=passing_yards_home, color = home)) + #geom_smooth(se=FALSE) + scale_color_manual(values = Team_colors)

#ggplot(nfl_stats[nfl_stats$home == c('Chiefs', 'Raiders', 'Chargers', 'Broncos'),], aes(x=game_number, y=rushing_yards_home, color = home)) + #geom_smooth(se=FALSE) + scale_color_manual(values = Team_colors)
#```